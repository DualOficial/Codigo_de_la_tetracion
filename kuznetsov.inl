namespace kuz{
	
	template< typename T >
	T slo( T z1 ){
		
		static long double DE[ 128 ] = {
			
			1.4192252155045112363l,
			-0.05213258059503801667l,
			 0.00693219127232187586l,
			-0.00015617045803377859l,
			-0.00100912103192385785l,
			 0.00082172671942507903l,
			-0.00035776641706493177l,
			-0.00000931803078422933l,
			 0.00016678111348857047l,
			-0.00014181446429806932l,
			 0.00003186488716454018l,
			 0.00006022937595596333l,
			-0.00007769822429012910l,
			 0.00002881816919640196l,
			 0.00003346765914794806l,
			-0.00005635940084759932l,
			 0.00002613708927959275l,
			 0.00002533341053138444l,
			-0.00005010441151688034l,
			 0.00002593810263640952l,
			 0.00002404611936084357l,
			-0.00005163238246428602l,
			 0.00002794638872473000l,
			 0.00002700739592764804l,
			-0.00005939035114511979l,
			 0.00003210955504312860l,
			 0.00003438232223525011l,
			-0.00007428278434380886l,
			 0.00003866302665809861l,
			 0.00004803799918127077l,
			-0.00009914141292927652l,
			 0.00004800025436154043l,
			 0.00007191960183392704l,
			-0.00013922522917537457l,
			 0.00006043126908005670l,
			 0.00011338211995240744l,
			-0.00020351111316586852l,
			 0.00007562971718596908l,
			 0.00018585637209671475l,
			-0.00030700846364341576l,
			 0.00009132512919756623l,
			 0.00031386108850653502l,
			-0.00047464470561729965l,
			 0.00010030770871287629l,
			 0.00054232170050706079l,
			-0.00074759603610534669l,
			 0.00008375204845585605l,
			 0.00095389423083896800l,
			-0.00119336225449479362l,
			-0.00000327383738614825l,
			 0.00170107934819055851l,
			-0.00192109516273315209l,
			-0.00026290310001950487l,
			 0.00306590657916818192l,
			-0.00310372506294090238l,
			-0.00091982425407694250l,
			 0.00556979490215834833l,
			-0.00500546835451257978l,
			-0.00245869651201214212l,
			 0.01017705593773498771l,
			-0.00800820238034244403l,
			-0.00590649361431362999l,
			 0.01866321477729812259l,
			-0.01260156096677063874l,
			-0.01341963601206602220l,
			 0.03429254345271898208l,
			-0.01926894593144593687l,
			-0.02946277663641767158l,
			 0.06300065960337521143l,
			-0.02800532706641396460l,
			-0.06325609033757989552l,
			 0.11556117355587923468l,
			-0.03708367328869965895l,
			-0.13352664223772733876l,
			 0.21104853030721187901l,
			-0.03941069742436464907l,
			-0.27853504829255953945l,
			 0.38331715278474703945l,
			-0.01491397058539710788l,
			-0.57446133459038406510l,
			 0.68905734940479856920l,
			 0.09065013779953061401l,
			-1.17542205931169707611l,
			 1.22536662105515059551l,
			 0.40500835675024698945l,
			-2.37977019901803332758l,
			 2.13411821810153146117l,
			 1.24184396615612624437l,
			-4.78947531960227212977l,
			 3.64093109251482172084l,
			 3.27095016057312193425l,
			-9.53051815711462246838l,
			 5.92750355113636295812l,
			 8.12068845726284394004l,
			-18.89123486907114468636l,
			 9.07245090167984002960l,
			18.99435214920948311601l,
			-36.62201395750987842348l,
			12.69160696640316032813l,
			43.73569046442687380249l,
			-71.43155879446639744401l,
			14.83661067193675719977l,
			95.94011857707508283966l,
			-135.28537549407113260713l,
			 4.55415019762845751927l,
			212.46383399209483400227l,
			-258.45286561264816782568l,
			-34.35533596837944259050l,
			440.37608695652170354151l,
			-466.49328063241102881875l,
			-184.78893280632408391284l,
			969.10988142292478642048l,
			-888.80079051383393107244l,
			-485.21897233201576682404l,
			1912.15652173913008482486l,
			-1381.80553359683767666866l,
			-1490.15335968379417863616l,
			4216.82213438735107047250l,
			-2565.99525691699591334327l,
			-3155.47826086956501967506l,
			7689.57470355731129529886l,
			-3206.47588932806274897303l,
			-8547.41501976284416741692l,
			17971.70592885375299374573l,
			-7203.41501976284507691162l,
			-16388.65454545454485923983l,
			28589.12885375493715400808l,
			-2355.80711462450562976301l
		};
		
		int K = 128 , k;
		T z = z1-T( 1 );
		
		z /= T( 2 );
		
		T s = 0; //lcomplex t=1;

		for( k = K - 1; k > 0; k-- ){
			
			s += DE[ k ];
			s *= z;

		}

		T Zo( 0.31813150520476413l , 1.3372357014306895l );
		T Zc( 0.31813150520476413l , -1.3372357014306895l );

		s += DE[ 0 ];
		s += log( z1 - Zo ) / Zo + log( z1 - Zc ) / Zc;
		
		return s;
	}

	template< typename T >
	T tet_gen( T z1 ){
		
		T Zo( 0.31813150520476413l , 1.3372357014306895l );
		auto x = z1.real() , y = z1.imag();
		
		if( abs( y ) > abs( Zo.imag() ) ) return tet_gen( log( z1 ) ) + T( 1 );
		if( x < Zo.real() ) return tet_gen( exp( z1 ) ) - T( 1 );
		if( x > 2 ) return tet_gen( log( z1 ) ) + T(1);
		
		T z = z1 - T( 1 );
		T LZ = log( z1 );
		
		if( abs( LZ - T( 1 ) ) < abs( z ) ) return tet_gen( LZ ) + T( 1 );

		//T EZ = exp( z1 ); if( abs( EZ - T( 1 ) ) < abs(z) ) return tet_gen( EZ ) - T( 1 );

		return slo( z1 );
	}

	template< typename T >
	T fima( T z ){
		
		T c,e;
		T Zo( 0.31813150520476413l , 1.3372357014306895l );
		T Zc( 0.31813150520476413l , -1.3372357014306895l );
		T R( 1.0779614375280l , -0.9465409639480l );
		T a2 = T( 5 ) / ( Zo - T( 1 ) );
		T a3 = ( a2 + T( 1 ) / T( 6 ) ) / ( Zo * Zo - T( 1 ) );
		T a4 = ( a2 / T( 2 ) + a2 * a2 / T( 2 ) + a3 + T( 1 ) / T( 24 ) ) / ( Zo * Zo * Zo - T( 1 ) );
		T a5 = ( T( 5 ) * a2 * a2 + a2 / T( 6 ) + a2 * a3 + a3 / T( 2 ) + a4 + T( 1 ) / T( 120 ) ) / ( Zo * Zo * Zo * Zo - T( 1 ) );
		T Li = T( 2 ) * constants::pi< decltype( z.real() ) >() * T( 0 , 1 );
		T b0 = T( 0.1223 , -0.02370 );
		
		//printf("b0 = %11.5Lf %11.5Lf\n", Re(b0),Im(b0 )) ;
		
		e = exp( Zo * z + R );
		c =  Zo + e * ( T( 1 ) + e * ( a2 + e * ( a3 + e * ( a4 + e * a5 ) ) ) + b0 * exp( Li * z ) );

		return c;
	}

	template< typename T >
	T tai3( T z ){
		
		int K = 50 , k;

		T DER3[ 51 ] = {
			
			T( 0.37090658903228507226, 1.33682167078891400713),
			T( 0.03660096537598455518, 0.13922215389950498565),
			T(-0.16888431840641535131, 0.09718533619629270148),
			T(-0.12681315048680869007,-0.11831628767028627702),
			T( 0.04235809310323926380,-0.10520930088320722129),
			T( 0.05848306393563178218,-0.00810224524496080435),
			T( 0.02340031665294847393, 0.01807777011820375229),
			T( 0.00344260984701375092, 0.01815103755635914459),
			T(-0.00803695814441672193, 0.00917428467034995393),
			T(-0.00704695528168774229,-0.00093958506727472686),
			T(-0.00184617963095305509,-0.00322342583181676459),
			T( 0.00054064885443097391,-0.00189672061015605498),
			T( 0.00102243648088806748,-0.00055968657179243165),
			T( 0.00064714396398048754, 0.00025980661935827123),
			T( 0.00010444455593372213, 0.00037199472598828116),
			T(-0.00011178535404343476, 0.00016786687552190863),
			T(-0.00010630158710808594, 0.00002072200033125881),
			T(-0.00005078098819110608,-0.00003575913005741248),
			T(-0.00000314742998690270,-0.00003523185937587781),
			T( 0.00001347661344130504,-0.00001333034137448205),
			T( 0.00000980239082395275, 0.00000047607184151673),
			T( 0.00000355493475454698, 0.00000389816212201278),
			T(-0.00000021552652645735, 0.00000296273413237997),
			T(-0.00000131673903627820, 0.00000097381354534333),
			T(-0.00000083401960806066,-0.00000018663858711081),
			T(-0.00000022869610981361,-0.00000037497716770031),
			T( 0.00000005372584613379,-0.00000023060136585176),
			T( 0.00000011406656653786,-0.00000006569510293486),
			T( 0.00000006663595460757, 0.00000002326630571343),
			T( 0.00000001396786846375, 0.00000003315118300198),
			T(-0.00000000684890556421, 0.00000001713041981611),
			T(-0.00000000916619598268, 0.00000000403886083652),
			T(-0.00000000502933384276,-0.00000000222121299478),
			T(-0.00000000084484352792,-0.00000000273668661113),
			T( 0.00000000070086729861,-0.00000000124687683156),
			T( 0.00000000070558101710,-0.00000000021962577544),
			T( 0.00000000035900951951, 0.00000000018774741308),
			T( 0.00000000005248658571, 0.00000000021201177126),
			T(-0.00000000006264758835, 0.00000000009059171879),
			T(-0.00000000005333473585, 0.00000000001006078866),
			T(-0.00000000002432138144,-0.00000000001506937008),
			T(-0.00000000000331880379,-0.00000000001544700067),
			T( 0.00000000000501652570,-0.00000000000658967459),
			T( 0.00000000000401214135,-0.00000000000036708383),
			T( 0.00000000000158629111, 0.00000000000119885992),
			T( 0.00000000000019668766, 0.00000000000106532662),
			T(-0.00000000000036355730, 0.00000000000047229527),
			T(-0.00000000000029920206, 0.00000000000001251827),
			T(-0.00000000000010305550,-0.00000000000009571381),
			T(-0.00000000000000910369,-0.00000000000007087680),
			T( 0.00000000000002418310,-0.00000000000003240337)

		};
		
		T s = 0 , t = 1;
		
		z -= T( 0 , 3 );
		z /= T( 2 );
		
		for( k = 0; k < K; k++ ){
			
			s += DER3[ k ] * t;
			t *= z;

		}
		
		return s;
	}

	template< typename T >
	T maclo(T z){
		
		int K = 100 , k;

		T d[ 110 ] = {
			
			0.30685281944005469058l,
			1.18353470251664338875l,
			1.58593285160678321155l,
			1.36629265207672068172l,
			1.36264601823980036066l,
			1.21734246689515424045l,
			1.10981816083559525765l,
			0.96674692974769849130l,
			0.84089872598668435888l,
			0.71353210966804747617l,
			0.60168548504001373445l,
			0.49928574281440518678l,
			0.41140086629121763728l,
			0.33506195665178500898l,
			0.27104779243942234146l,
			0.21728554054610033086l,
			0.17311050207880035456l,
			0.13690016038526570119l,
			0.10765949732729711286l,
			0.08413804539743192923l,
			0.06542450487497340761l,
			0.05060001212013485322l,
			0.03895655493977817629l,
			0.02985084640296329153l,
			0.02277908979501017117l,
			0.01730960309240666892l,
			0.01310389615589767874l,
			0.00988251130733762764l,
			0.00742735935367278347l,
			0.00556296426263720549l,
			0.00415334478103463346l,
			0.00309116153137843543l,
			0.00229387529664008653l,
			0.00169729976398295653l,
			0.00125245885041635465l,
			0.00092172809095368547l,
			0.00067661152429638357l,
			0.00049544127485341987l,
			0.00036192128589181518l,
			0.00026376927786672476l,
			0.00019180840045267570l,
			0.00013917553105723647l,
			0.00010077412023867018l,
			0.00007281884753121133l,
			0.00005251474516228446l,
			0.00003779882770351268l,
			0.00002715594536867241l,
			0.00001947408515177282l,
			0.00001394059355016322l,
			0.00000996213949015693l,
			0.00000710713872292710l,
			0.00000506199803708578l,
			0.00000359960968975399l,
			0.00000255569149787694l,
			0.00000181175810338313l,
			0.00000128245831538430l,
			0.00000090647322737496l,
			0.00000063980422418981l,
			0.00000045095738191441l,
			0.00000031741772125007l,
			0.00000022312521183625l,
			0.00000015663840476155l,
			0.00000010982301013230l,
			0.00000007690305934973l,
			0.00000005378502675604l,
			0.00000003757126131521l,
			0.00000002621429405247l,
			0.00000001826909956818l,
			0.00000001271754463425l,
			0.00000000884310192977l,
			0.00000000614230041407l,
			0.00000000426177146865l,
			0.00000000295386817285l,
			0.00000000204522503591l,
			0.00000000141464900426l,
			0.00000000097750884878l,
			0.00000000067478454029l,
			0.00000000046535930671l,
			0.00000000032062550784l,
			0.00000000022069891976l,
			0.00000000015177557961l,
			0.00000000010428189463l,
			0.00000000007158597119l,
			0.00000000004909806710l,
			0.00000000003364531769l,
			0.00000000002303635851l,
			0.00000000001575933679l,
			0.00000000001077213757l,
			0.00000000000735717912l,
			0.00000000000502077719l,
			0.00000000000342362421l,
			0.00000000000233271256l,
			0.00000000000158818623l,
			0.00000000000108046566l,
			0.00000000000073450488l,
			0.00000000000049894945l,
			0.00000000000033868911l,
			0.00000000000022973789l,
			0.00000000000015572383l,
			0.00000000000010548054l,
			0.00000000000007139840l,
			0.00000000000004829557l,
			0.00000000000003264619l,
			0.00000000000002205299l,
			0.00000000000001488731l,
			0.00000000000001004347l,
			0.00000000000000677124l,
			0.00000000000000456225l,
			0.00000000000000307196l,
			0.00000000000000206720l

		};

		T s = 0;
		T z2 = z / T( 2 );
		T t = 1;

		for( k = 0; k <= K; k++ ){
			
			s += d[ k ] * t;
			t *= z2;

		}

		return s + log( z + T( 2 ) );
	}

	template< typename T >
	T FIMA( T z ){
		
		auto x = z.real();
		auto y = z.imag();

		if( y < T( 0.2379 ).real() * x ) return exp( FIMA( z - T( 1 ) ) );

		return fima( z );
	}

	template< typename T >
	T TAI3( T z ){
		
		auto x = z.real();

		if( x > T( 0.5 ).real() ) return exp( TAI3( z - T( 1 ) ) );
		if( x < T( -0.5 ).real() ) return log( TAI3( z + T( 1 ) ) );

		return tai3( z );
	}

	template< typename T >
	T MACLO( T z ){
		
		auto x = z.real(); 
		T c;

		if( x > T( 0.5 ).real() ){
			
			c = z - T( 1 );
			c = MACLO( c );
			c = exp( c );

			//printf("about to return (%9.3Lf, %9.3Lfi)\n",Re(c),Im(c));
			//getchar();

			return c;
		}
	
		if( x < -T( 0.5 ).real() ) return log( MACLO( z + T( 1 ) ) );

		return maclo( z ); 
	}

	template< typename T >
	T tet( T z ){
		
		auto y = z.imag();

		if( y > T( 4.5 ).real() ) return FIMA( z );
		if( y > T( 1.5 ).real() ) return TAI3( z );
		if( y > -T( 1.5 ).real() ) return MACLO( z );
		if( y > -T( 4.5 ).real() ) return conj( TAI3( conj( z ) ) );

		return conj( FIMA( conj( z ) ) );
	}

	template< typename T >
	T tet( T final_exp , T height ){
		
		return tet( tet_gen( final_exp ) + height );

	}
	
	template< typename T >
	T tet_gen( T final_exp , T result ){
		
		return tet_gen( result ) - tet_gen( final_exp );
		
	}
	
}
